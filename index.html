<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RinoTennis</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlJpbm9UZW5uaXMiLAogICJzaG9ydF9uYW1lIjogIlJpbm9UZW5uaXMiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgInRoZW1lX2NvbG9yIjogIiMxNmEzNGEiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmMGZkZjQiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOnNiZy9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpRaUlHaGxhV2RvZEQwaU1qUWlJSFpwWlhkQ2IzZzlJakFnTUNBeU5DQXlOQ0lnWm1sc2JEMGlJekUyWVRNMFlTSStQSEJoZEdnZ1pEMGlUVEV5SUMweUxESXlJREV6TGpRZ01UQXRPQ0ExTGpRZ1REUXROelJNTmpBeE5TNHhMVFEzTGpBdE5Ea3VNRU1nTlRNZ01ESXRNVTR1T0MwNUxqVXpNVFpoTWk0ek1EQXRORGN1T1NNME9TNDFNelF0TVRjdU5UZ3dNemt1TlRRZ05USWdPU0l2UGp3dmMzWm5QZz09IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    <meta name="theme-color" content="#16a34a">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Icone Lucide come componenti React
        const Trophy = () => React.createElement('svg', {
            width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M6 9H4.5a2.5 2.5 0 0 1 0-5H6' }), React.createElement('polyline', { points: '6,9 12,9 18,9' }), React.createElement('path', { d: 'M18 9h1.5a2.5 2.5 0 0 1 0 5H18' }), React.createElement('path', { d: 'M12 12v9' }), React.createElement('path', { d: 'M8 21h8' }));
        
        const RefreshCw = () => React.createElement('svg', {
            width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8' }), React.createElement('path', { d: 'M21 3v5h-5' }), React.createElement('path', { d: 'M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16' }), React.createElement('path', { d: 'M3 21v-5h5' }));
        
        const MessageCircle = () => React.createElement('svg', {
            width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M7.9 20A9 9 0 1 0 4 16.1L2 22Z' }));
        
        const AlertCircle = () => React.createElement('svg', {
            width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, React.createElement('circle', { cx: 12, cy: 12, r: 10 }), React.createElement('line', { x1: 12, y1: 8, x2: 12, y2: 12 }), React.createElement('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 }));
        
        const Calendar = () => React.createElement('svg', {
            width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, React.createElement('rect', { width: 18, height: 18, x: 3, y: 4, rx: 2, ry: 2 }), React.createElement('line', { x1: 16, y1: 2, x2: 16, y2: 6 }), React.createElement('line', { x1: 8, y1: 2, x2: 8, y2: 6 }), React.createElement('line', { x1: 3, y1: 10, x2: 21, y2: 10 }));
        
        const Award = () => React.createElement('svg', {
            width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, React.createElement('circle', { cx: 12, cy: 8, r: 6 }), React.createElement('path', { d: 'm9 12 2 2 4-4' }), React.createElement('path', { d: 'm21 21-7-7' }), React.createElement('path', { d: 'm3 21 7-7' }));
        
        const BarChart3 = () => React.createElement('svg', {
            width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M3 3v18h18' }), React.createElement('path', { d: 'm19 9-5 5-4-4-3 3' }));
        
        const TrendingUp = () => React.createElement('svg', {
            width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round'
        }, React.createElement('polyline', { points: '22,7 13.5,15.5 8.5,10.5 2,17' }), React.createElement('polyline', { points: '16,7 22,7 22,13' }));

        // Mock dell'API Claude per demo
        window.claude = {
            complete: async (prompt) => {
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                if (prompt.includes('domanda')) {
                    return JSON.stringify({
                        question: "Chi detiene il record di vittorie consecutive su terra rossa nell'era Open?",
                        options: {
                            A: "Bjorn Borg",
                            B: "Rafael Nadal",
                            C: "Guillermo Vilas",
                            D: "Thomas Muster"
                        },
                        correctAnswer: "B",
                        explanation: "Rafael Nadal detiene il record con 81 vittorie consecutive su terra rossa dal 2005 al 2007, un'impresa straordinaria che dimostra il suo dominio assoluto su questa superficie.",
                        funFact: "Durante questa striscia, Nadal vinse 13 tornei consecutivi su terra battuta, inclusi due Roland Garros!",
                        stats: {
                            mainStat: "Vittorie consecutive",
                            value: "81",
                            context: "Su terra rossa (2005-2007)"
                        }
                    });
                } else {
                    return JSON.stringify({
                        response: "Ottima domanda! Nel tennis dell'era Open ci sono tantissime statistiche affascinanti. Per esempio, Steffi Graf è l'unica tennista ad aver completato il Golden Slam (tutti e 4 i tornei del Grande Slam più l'oro olimpico) in un singolo anno (1988).",
                        hasStats: true,
                        stats: {
                            title: "Golden Slam di Steffi Graf",
                            data: "1988 - Unica nella storia del tennis"
                        }
                    });
                }
            }
        };
    </script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const RinoTennis = () => {
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showResult, setShowResult] = useState(false);
            const [userQuestion, setUserQuestion] = useState('');
            const [chatHistory, setChatHistory] = useState([]);
            const [loading, setLoading] = useState(false);
            const [errorLog, setErrorLog] = useState([]);
            const [showErrorConsole, setShowErrorConsole] = useState(false);
            const [dailyQuestionAnswered, setDailyQuestionAnswered] = useState(false);

            const logError = (error, context) => {
                const errorEntry = {
                    timestamp: new Date().toLocaleString('it-IT'),
                    context: context,
                    message: error.message || error,
                    stack: error.stack || 'N/A'
                };
                setErrorLog(prev => [errorEntry, ...prev.slice(0, 49)]);
                console.error('RinoTennis Error:', errorEntry);
            };

            const generateQuestion = async (isDaily = false) => {
                try {
                    setLoading(true);
                    const response = await window.claude.complete('genera domanda tennis');
                    const questionData = JSON.parse(response);
                    
                    setCurrentQuestion(questionData);
                    setSelectedAnswer(null);
                    setShowResult(false);
                    
                    if (isDaily) {
                        setDailyQuestionAnswered(false);
                    }
                } catch (error) {
                    logError(error, 'generateQuestion');
                    setCurrentQuestion({
                        question: "Chi ha vinto più tornei del Grande Slam nella storia del tennis maschile?",
                        options: {
                            A: "Roger Federer",
                            B: "Rafael Nadal", 
                            C: "Novak Djokovic",
                            D: "Pete Sampras"
                        },
                        correctAnswer: "C",
                        explanation: "Novak Djokovic detiene il record con 24 titoli del Grande Slam nel tennis maschile.",
                        funFact: "Djokovic ha completato il Career Golden Masters per 3 volte!",
                        stats: {
                            mainStat: "Titoli Grande Slam",
                            value: "24",
                            context: "Record maschile"
                        }
                    });
                } finally {
                    setLoading(false);
                }
            };

            const handleAnswerSelect = (answer) => {
                if (showResult) return;
                setSelectedAnswer(answer);
                setShowResult(true);
                setDailyQuestionAnswered(true);
            };

            const handleUserQuestion = async () => {
                if (!userQuestion.trim()) return;
                
                try {
                    setLoading(true);
                    const userMsg = { role: 'user', content: userQuestion };
                    const updatedHistory = [...chatHistory, userMsg];
                    
                    const response = await window.claude.complete(userQuestion);
                    const aiResponse = JSON.parse(response);
                    
                    const aiMsg = { role: 'assistant', content: aiResponse.response, stats: aiResponse.stats };
                    setChatHistory([...updatedHistory, aiMsg]);
                    setUserQuestion('');
                } catch (error) {
                    logError(error, 'handleUserQuestion');
                    const errorMsg = { role: 'assistant', content: 'Scusa, ho avuto un problema nel rispondere. Riprova!' };
                    setChatHistory(prev => [...prev, { role: 'user', content: userQuestion }, errorMsg]);
                    setUserQuestion('');
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                generateQuestion(true);
            }, []);

            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-green-100">
                    <div className="bg-gradient-to-r from-green-600 to-green-700 text-white p-4 shadow-lg">
                        <div className="flex items-center justify-between max-w-md mx-auto">
                            <div className="flex items-center gap-3">
                                <div className="relative">
                                    <Trophy className="w-8 h-8 text-yellow-300" />
                                    <div className="absolute -top-1 -right-1 w-3 h-3 bg-yellow-400 rounded-full animate-pulse"></div>
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold">RinoTennis</h1>
                                    <p className="text-green-100 text-xs">Tennis Quiz & Stats</p>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <Calendar className="w-5 h-5 text-green-200" />
                                <button 
                                    onClick={() => setShowErrorConsole(!showErrorConsole)}
                                    className="text-green-200 hover:text-white"
                                >
                                    <AlertCircle className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-md mx-auto p-4 space-y-6">
                        
                        {showErrorConsole && (
                            <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                                <div className="flex justify-between items-center mb-2">
                                    <h3 className="font-semibold text-red-800">Console Errori</h3>
                                    <button 
                                        onClick={() => setErrorLog([])}
                                        className="text-red-600 text-sm hover:text-red-800"
                                    >
                                        Pulisci
                                    </button>
                                </div>
                                <div className="max-h-40 overflow-y-auto space-y-1">
                                    {errorLog.length === 0 ? (
                                        <p className="text-green-600 text-sm">Nessun errore registrato ✓</p>
                                    ) : (
                                        errorLog.map((error, idx) => (
                                            <div key={idx} className="text-xs bg-red-100 p-2 rounded border-l-2 border-red-400">
                                                <div className="font-mono text-red-800">[{error.timestamp}] {error.context}</div>
                                                <div className="text-red-600">{error.message}</div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}

                        <div className="bg-white rounded-xl shadow-lg border-l-4 border-green-500 overflow-hidden">
                            <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-4">
                                <div className="flex items-center gap-2">
                                    <Award className="w-5 h-5" />
                                    <span className="font-semibold">Domanda del Giorno</span>
                                    {dailyQuestionAnswered && <span className="text-green-200 text-sm">✓ Completata</span>}
                                </div>
                            </div>
                            
                            {loading && !currentQuestion ? (
                                <div className="p-6 text-center">
                                    <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto"></div>
                                    <p className="mt-2 text-gray-600">Generando domanda...</p>
                                </div>
                            ) : currentQuestion ? (
                                <div className="p-4">
                                    <h3 className="font-semibold text-gray-800 mb-4">{currentQuestion.question}</h3>
                                    
                                    <div className="space-y-2 mb-4">
                                        {Object.entries(currentQuestion.options).map(([key, value]) => (
                                            <button
                                                key={key}
                                                onClick={() => handleAnswerSelect(key)}
                                                disabled={showResult}
                                                className={`w-full text-left p-3 rounded-lg border transition-all ${
                                                    selectedAnswer === key
                                                        ? key === currentQuestion.correctAnswer
                                                            ? 'bg-green-100 border-green-500 text-green-800'
                                                            : 'bg-red-100 border-red-500 text-red-800'
                                                        : showResult && key === currentQuestion.correctAnswer
                                                        ? 'bg-green-100 border-green-500 text-green-800'
                                                        : 'bg-gray-50 border-gray-200 hover:bg-gray-100'
                                                }`}
                                            >
                                                <span className="font-semibold">{key})</span> {value}
                                            </button>
                                        ))}
                                    </div>

                                    {showResult && (
                                        <div className="space-y-4 pt-4 border-t">
                                            <div className="bg-blue-50 p-4 rounded-lg">
                                                <h4 className="font-semibold text-blue-800 mb-2">Spiegazione</h4>
                                                <p className="text-blue-700 text-sm">{currentQuestion.explanation}</p>
                                            </div>

                                            {currentQuestion.stats && (
                                                <div className="bg-purple-50 p-4 rounded-lg">
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <BarChart3 className="w-4 h-4 text-purple-600" />
                                                        <h4 className="font-semibold text-purple-800">Statistiche</h4>
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-2 text-sm">
                                                        <div>
                                                            <span className="text-purple-600">{currentQuestion.stats.mainStat}:</span>
                                                            <span className="font-bold text-purple-800 ml-1">{currentQuestion.stats.value}</span>
                                                        </div>
                                                        <div className="text-purple-700">{currentQuestion.stats.context}</div>
                                                    </div>
                                                </div>
                                            )}

                                            <div className="bg-yellow-50 p-4 rounded-lg">
                                                <div className="flex items-center gap-2 mb-2">
                                                    <TrendingUp className="w-4 h-4 text-yellow-600" />
                                                    <h4 className="font-semibold text-yellow-800">Lo Sapevi Che...</h4>
                                                </div>
                                                <p className="text-yellow-700 text-sm">{currentQuestion.funFact}</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ) : null}
                        </div>

                        <button
                            onClick={() => generateQuestion(false)}
                            disabled={loading}
                            className="w-full bg-green-600 hover:bg-green-700 text-white p-4 rounded-xl font-semibold flex items-center justify-center gap-2 transition-colors disabled:opacity-50"
                        >
                            <RefreshCw className={`w-5 h-5 ${loading ? 'animate-spin' : ''}`} />
                            {loading ? 'Generando...' : 'Nuova Domanda'}
                        </button>

                        <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                            <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4">
                                <div className="flex items-center gap-2">
                                    <MessageCircle className="w-5 h-5" />
                                    <span className="font-semibold">Fai una Domanda</span>
                                </div>
                            </div>
                            
                            <div className="p-4">
                                <div className="flex gap-2 mb-4">
                                    <input
                                        type="text"
                                        value={userQuestion}
                                        onChange={(e) => setUserQuestion(e.target.value)}
                                        placeholder="Chiedi qualcosa sul tennis..."
                                        className="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        onKeyPress={(e) => e.key === 'Enter' && handleUserQuestion()}
                                    />
                                    <button
                                        onClick={handleUserQuestion}
                                        disabled={loading || !userQuestion.trim()}
                                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg disabled:opacity-50 transition-colors"
                                    >
                                        Invia
                                    </button>
                                </div>

                                <div className="space-y-3 max-h-64 overflow-y-auto">
                                    {chatHistory.map((msg, idx) => (
                                        <div key={idx} className={msg.role === 'user' ? 'text-right' : 'text-left'}>
                                            <div className={`inline-block p-3 rounded-lg max-w-[80%] ${
                                                msg.role === 'user' 
                                                    ? 'bg-blue-100 text-blue-800' 
                                                    : 'bg-gray-100 text-gray-800'
                                            }`}>
                                                <p className="text-sm">{msg.content}</p>
                                                {msg.stats && msg.stats.title && (
                                                    <div className="mt-2 p-2 bg-white rounded border-l-2 border-blue-400">
                                                        <div className="text-xs font-semibold text-blue-700">{msg.stats.title}</div>
                                                        <div className="text-xs text-blue-600">{msg.stats.data}</div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        <div className="text-center py-4">
                            <p className="text-xs text-gray-400 opacity-50">by Cesco</p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<RinoTennis />, document.getElementById('root'));
    </script>

    <script>
        // Registra Service Worker per PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZXZlbnQpIHsgZXZlbnQud2FpdFVudGlsKGNhY2hlcy5vcGVuKCdyaW5vdGVubmlzLXYxJykudGhlbihmdW5jdGlvbihjYWNoZSkgeyByZXR1cm4gY2FjaGUuYWRkQWxsKFsnLyddKTsgfSkpOyB9KTs=');
        }
        
        // Previeni zoom su doppio tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
